Object.defineProperty(exports, "__esModule", { value: true });
var constant_1 = require("../commons/constant");
var succinct_1 = require("../succinct");
var context_1 = require("../context");
function initialSuccinc(value) {
    if (value[constant_1.IDENTITY])
        return;
    value[constant_1.IDENTITY] = new succinct_1.default();
}
// function enhancerModel<T>(target: new (state: any) => T, value: any);
// function enhancerModel<T>(target: new (state: any) => T, value: any, key: string, descriptor: Descriptor);
function enhancerModel(target, value, key, descriptor) {
    // if (key && descriptor) {
    // }
    // return new target(value); 
    initialSuccinc(value);
    var des = {
        configurable: true,
        enumerable: descriptor.enumerable,
        get: function () {
            var currentContext = context_1.default.getContext();
            return this[constant_1.IDENTITY].get(key, currentContext);
        },
        set: function (newValue) {
            this[constant_1.IDENTITY].set(new target(newValue));
        }
    };
    return des;
}
function Model(target) {
    return enhancerModel.bind(null, target);
}
exports.default = Model;
