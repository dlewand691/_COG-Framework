{"version":3,"sources":["es/connect/index.js"],"names":["__extends","extendStatics","Object","setPrototypeOf","__proto__","Array","d","b","p","hasOwnProperty","__","constructor","prototype","create","__assign","assign","t","s","i","n","arguments","length","call","React","storeShape","Reaction","reactiveMixin","componentWillMount","_this","baseRender","render","bind","reactiveRender","exception","undefined","rendering","$reaction","track","e","componentWillUnmount","dispose","makeSelectorStateful","sourceSelector","store","selector","shouldComponentUpdate","props","error","run","runComponentSelector","nextProps","getState","patch","target","funcName","runMixinFirst","base","mixinFunc","f","apply","mixinLifecycleEvents","connect","mapStateToProps","options","_a","storeKey","Target","ConnectComponent","_super","context","contextTypes","isRequired","componentWillReceiveProps","createElement","Component"],"mappings":"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","file":"index.js","sourceRoot":"/Users/sheweichun/opensource/succinct/packages/succinct","sourcesContent":["var __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n        s = arguments[i];\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n            t[p] = s[p];\n    }\n    return t;\n};\nimport React from 'react';\nimport { storeShape } from '../provider';\nimport Reaction from '../reaction';\nvar reactiveMixin = {\n    componentWillMount: function () {\n        var _this = this;\n        var baseRender = this.render.bind(this);\n        var reactiveRender = function () {\n            var exception = undefined;\n            var rendering = undefined;\n            _this.$reaction.track(function () {\n                try {\n                    rendering = baseRender();\n                }\n                catch (e) {\n                    exception = e;\n                }\n            });\n            if (exception) {\n                throw exception;\n            }\n            return rendering;\n        };\n        this.render = reactiveRender;\n    },\n    componentWillUnmount: function () {\n        this.$reaction && this.$reaction.dispose();\n    }\n};\nfunction makeSelectorStateful(sourceSelector, store) {\n    var selector = {\n        shouldComponentUpdate: true,\n        props: {},\n        error: null,\n        run: function runComponentSelector(props) {\n            try {\n                var nextProps = sourceSelector(store.getState(), props);\n                if (nextProps !== selector.props || selector.error) {\n                    selector.shouldComponentUpdate = true;\n                    selector.props = nextProps;\n                    selector.error = null;\n                }\n            }\n            catch (error) {\n                selector.shouldComponentUpdate = true;\n                selector.error = error;\n            }\n        }\n    };\n    return selector;\n}\nfunction patch(target, funcName, runMixinFirst) {\n    if (runMixinFirst === void 0) { runMixinFirst = false; }\n    var base = target[funcName];\n    var mixinFunc = reactiveMixin[funcName];\n    var f = !base\n        ? mixinFunc\n        : runMixinFirst === true\n            ? function () {\n                mixinFunc.apply(this, arguments);\n                base.apply(this, arguments);\n            }\n            : function () {\n                base.apply(this, arguments);\n                mixinFunc.apply(this, arguments);\n            };\n    target[funcName] = f;\n}\nfunction mixinLifecycleEvents(target) {\n    patch(target, \"componentWillMount\", true);\n    patch(target, \"componentWillUnmount\");\n}\nexport default function connect(mapStateToProps, options) {\n    if (options === void 0) { options = {}; }\n    var _a = options.storeKey, storeKey = _a === void 0 ? \"store\" : _a;\n    return function (Target) {\n        var ConnectComponent = (function (_super) {\n            __extends(ConnectComponent, _super);\n            function ConnectComponent(props, context) {\n                var _this = _super.call(this, props) || this;\n                _this.contextTypes = (_a = {},\n                    _a[storeKey] = storeShape.isRequired,\n                    _a);\n                _this.store = props[storeKey] || context[storeKey];\n                _this.selector = makeSelectorStateful(mapStateToProps, _this.store);\n                _this.selector.run(props);\n                _this.$reaction = new Reaction(_this);\n                return _this;\n                var _a;\n            }\n            ConnectComponent.prototype.componentWillReceiveProps = function (nextProps) {\n                this.selector.run(nextProps);\n            };\n            ConnectComponent.prototype.shouldComponentUpdate = function () {\n                return this.selector.shouldComponentUpdate;\n            };\n            ConnectComponent.prototype.render = function () {\n                var props = this.selector.props;\n                return React.createElement(Target, __assign({}, props));\n            };\n            return ConnectComponent;\n        }(React.Component));\n        ;\n        mixinLifecycleEvents(ConnectComponent.prototype || ConnectComponent);\n        // ConnectComponent\n        return ConnectComponent;\n    };\n}\n"]}