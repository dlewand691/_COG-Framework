{"version":3,"sources":["lib/succinct/index.js"],"names":["Object","defineProperty","exports","value","SUCCINCT_IDENTITY","succinct_id","Succinct","subcribes","id","subcribeMap","prototype","dispatch","func","forEach","subscrib","forceUpdate","removeSubscribe","ctx","cache","splice","index","get","key","host","addSuccinct","reaction","length","push","set","action","default"],"mappings":"AAAAA,OAAOC,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C,EAAEC,OAAO,IAAT,EAA7C;AACA,IAAIC,oBAAoB,UAAxB;AACA,IAAIC,cAAc,CAAlB;AACA,IAAIC,WAAY,YAAY;AACxB,aAASA,QAAT,CAAkBH,KAAlB,EAAyBI,SAAzB,EAAoC;AAChC,YAAIJ,UAAU,KAAK,CAAnB,EAAsB;AAAEA,oBAAQ,EAAR;AAAa;AACrC,YAAII,cAAc,KAAK,CAAvB,EAA0B;AAAEA,wBAAY,EAAZ;AAAiB;AAC7C,aAAKJ,KAAL,GAAaA,KAAb;AACA,aAAKK,EAAL,GAAUH,aAAV;AACA,aAAKI,WAAL,GAAmB,EAAnB;AACA,aAAKF,SAAL,GAAiBA,SAAjB;AACH;AACDD,aAASI,SAAT,CAAmBC,QAAnB,GAA8B,UAAUC,IAAV,EAAgB;AAC1CA;AACA,aAAKL,SAAL,IAAkB,KAAKA,SAAL,CAAeM,OAAf,CAAuB,UAAUC,QAAV,EAAoB;AACzDA,qBAASC,WAAT;AACH,SAFiB,CAAlB;AAGH,KALD;AAMAT,aAASI,SAAT,CAAmBM,eAAnB,GAAqC,UAAUC,GAAV,EAAe;AAChD,YAAIC,QAAQ,KAAKT,WAAL,CAAiBQ,IAAIT,EAArB,CAAZ;AACA,aAAKC,WAAL,CAAiBQ,IAAIT,EAArB,IAA2B,IAA3B;AACA,aAAKD,SAAL,CAAeY,MAAf,CAAsBD,MAAME,KAA5B,EAAmC,CAAnC;AACH,KAJD;AAKAd,aAASI,SAAT,CAAmBW,GAAnB,GAAyB,UAAUC,GAAV,EAAeL,GAAf,EAAoB;AACzC,YAAIA,OAAOA,IAAIM,IAAf,EAAqB;AACjBN,gBAAIO,WAAJ,CAAgB,IAAhB;AACA,gBAAI,CAAC,KAAKf,WAAL,CAAiBQ,IAAIT,EAArB,CAAL,EAA+B;AAC3B,qBAAKC,WAAL,CAAiBQ,IAAIT,EAArB,IAA2B;AACvBiB,8BAAUR,GADa;AAEvBG,2BAAO,KAAKb,SAAL,CAAemB;AAFC,iBAA3B;AAIA,qBAAKnB,SAAL,CAAeoB,IAAf,CAAoBV,IAAIM,IAAxB;AACH;AACJ;AACD,eAAO,KAAKpB,KAAL,CAAWmB,GAAX,CAAP;AACH,KAZD;AAaAhB,aAASI,SAAT,CAAmBkB,GAAnB,GAAyB,UAAUN,GAAV,EAAenB,KAAf,EAAsB;AAC3C,aAAKA,KAAL,CAAWmB,GAAX,IAAkBnB,KAAlB;AACH,KAFD;AAGAG,aAASI,SAAT,CAAmBmB,MAAnB,GAA4B,UAAUP,GAAV,EAAenB,KAAf,EAAsB;AAC9C,aAAKA,KAAL,CAAWmB,GAAX,IAAkB,KAAKX,QAAL,CAAcR,KAAd,CAAlB;AACH,KAFD;AAGA,WAAOG,QAAP;AACH,CAxCe,EAAhB;AAyCAJ,QAAQ4B,OAAR,GAAkBxB,QAAlB","file":"index.js","sourceRoot":"/Users/sheweichun/opensource/succinct/packages/succinct","sourcesContent":["Object.defineProperty(exports, \"__esModule\", { value: true });\nvar SUCCINCT_IDENTITY = 'Succinct';\nvar succinct_id = 0;\nvar Succinct = (function () {\n    function Succinct(value, subcribes) {\n        if (value === void 0) { value = {}; }\n        if (subcribes === void 0) { subcribes = []; }\n        this.value = value;\n        this.id = succinct_id++;\n        this.subcribeMap = {};\n        this.subcribes = subcribes;\n    }\n    Succinct.prototype.dispatch = function (func) {\n        func();\n        this.subcribes && this.subcribes.forEach(function (subscrib) {\n            subscrib.forceUpdate();\n        });\n    };\n    Succinct.prototype.removeSubscribe = function (ctx) {\n        var cache = this.subcribeMap[ctx.id];\n        this.subcribeMap[ctx.id] = null;\n        this.subcribes.splice(cache.index, 1);\n    };\n    Succinct.prototype.get = function (key, ctx) {\n        if (ctx && ctx.host) {\n            ctx.addSuccinct(this);\n            if (!this.subcribeMap[ctx.id]) {\n                this.subcribeMap[ctx.id] = {\n                    reaction: ctx,\n                    index: this.subcribes.length\n                };\n                this.subcribes.push(ctx.host);\n            }\n        }\n        return this.value[key];\n    };\n    Succinct.prototype.set = function (key, value) {\n        this.value[key] = value;\n    };\n    Succinct.prototype.action = function (key, value) {\n        this.value[key] = this.dispatch(value);\n    };\n    return Succinct;\n}());\nexports.default = Succinct;\n"]}